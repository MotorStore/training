<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>hidePlayer</title>
</head>
<style type="text/css">
* {margin:0;padding:0;list-style:none;}
.player {width:360px;font-size:12px;margin:50px;position:relative;border:1px solid #f5f5f5;padding:3px;}
.player h2 {font-size:14px;line-height:30px;text-align:center;color:skyblue;}
.player .progress {height:10px;background:#ccc;margin-bottom:10px;overflow:hidden;}
.player .progress em {display:block;height:10px;width:180px;background:skyblue;}
.player .hoz {clear:both;height:20px; padding-top:1px;padding-left:50px;}
.player .hoz label {float:left;line-height:25px;}
.player .hoz .progress {margin:7px 10px 0;}
.player .time {text-align:center;}
.player .vol {width:100px;float:left;}
.player a {line-height:25px;color:#369;text-decoration:none;}
.player a.muted {line-height:25px;color:#999;}
.player a.playing {position:absolute;left:50%;top:50%;margin:-40px 0 0 -30px;display:block;width:53px;height:54px;background:url(images/stop.png);overflow:hidden;line-height:500px;opacity:0.2;_filter:alpha(opacity=20);}
.player a.stop {background:url(images/play.png);}
.player a.playing:hover {opacity:1;_filter:alpha(opacity=100);}
</style>
<body>

<div class="player" id="player">
	<h2></h2>
	<div id="live_SWF"></div>
	
	<p class="progress probar"><em></em></p>
	<p class="time"></p>
	
	<div class="hoz">
		<label>音量控制：</label>
		<p class="progress vol"><em></em></p>
		<a href="javascript:void(0)" class="mute">静音</a>
	</div>
	
	<a href="javascript:void(0)" class="playing">暂停</a>
	<div style="clear:both;height:0;overflow:hidden;"></div>
</div>
<script type="text/javascript" language="javascript" src="swfobject.js"></script>
<script type="text/javascript">

start("http://rm.sina.com.cn/wm/VZ200807031731477717VK/music/MUSIC0807031732007910.mp3","a perfact indian -- o`conner");

function start(url,_title){
	var play = $("#player a.playing")[0];
	var mute = $("#player a.mute")[0];
	var volP = $("#player p.vol")[0];
	var vol = $("#player p.vol em")[0];
	var proP = $("#player p.probar")[0];
	var pro = $("#player p.probar em")[0];
	var timeshow = $("#player p.time")[0];
	var title = $("#player h2")[0];
	var pt = 0.5;
	var timeLong;
	var g_hidePlayer = createSWF("images/hidePlayer.swf?onReady=onReady&onPlaying=onPlaying&onLoadComplete=onLoadComplete&onLoadError=onerror&onPlayComplete=onended", "live_SWF", 1,1);

	title.innerHTML = _title;
	var t = setInterval(function(){
		if(g_hidePlayer.load){
			g_hidePlayer.load(url, true);
			g_hidePlayer.playSong();
			g_hidePlayer.setVolume(pt);
			vol.style.width = volP.clientWidth*pt + 'px';
			clearInterval(t);
		}
	},50); 	
	
	play.onclick = function(){
		if(this.className.indexOf('stop')>-1){
			g_hidePlayer.playSong();	
			this.className = this.className.replace(' stop','');
			this.innerHTML = "暂停";
		}else{
			g_hidePlayer.pauseSong();
			this.className += ' stop';
			this.innerHTML = "播放";
		}
	}
	mute.onclick = function(){
		if(this.className.indexOf('muted')>-1){
			g_hidePlayer.setMute(false);
			this.className = this.className.replace(' muted','');
		}else{
			g_hidePlayer.setMute(true);
			this.className += ' muted';
		}
	}
	volP.onclick = function(event){
		var pt = getOffsetX(this,event);
		g_hidePlayer.setVolume(pt);
		vol.style.width = volP.clientWidth*pt + 'px';
	}
	proP.onclick = function(event){
		var pt = getOffsetX(this,event);
		var cur = timeLong*pt;
		g_hidePlayer.playSong(cur);
		pro.style.width = proP.clientWidth*pt + 'px';
		setTimeout(function(){
			timeshow.innerHTML = timeFormat(cur) + '/' + timeFormat(timeLong);
		},500);
	}
	
	setInterval(function(){
		onPlaying();
	},500)

	function onPlaying(){
		timeLong = g_hidePlayer.getTotalTimes()/1000;
		var cur = g_hidePlayer.getPosition()/1000;
		var pt = cur/timeLong;
		timeshow.innerHTML = timeFormat(cur) + '/' + timeFormat(timeLong);
		pro.style.width = proP.clientWidth*pt + 'px';
	}
	function onended(){
		g_hidePlayer.playSong();
	}
}

function $(slector,obj){
	var els;
	var a = slector.indexOf("#")>-1 ? "#" + slector.split("#")[slector.split("#").length-1] : slector;
	var b = a.split(" "),len = b.length;
	if((len == 1) && (b[0].indexOf("#")>-1)){
		els = document.getElementById(b[0].split("#")[1]);
	}else{	
		var obj = obj || document.getElementsByTagName('body')[0];
		var	els = [obj];
		for(var i=0;i<len;i++) els = getEls(els,b[i]);
	}
	return els;
	function getEls(_obj,slector){
		var els = [];
		for(var i=0,len = _obj.length;i<len;i++){
			if(slector.indexOf("#")>-1){
				var objID = document.getElementById(slector.split("#")[1]);
				if (objID) els.push(objID);
			}else{
				var el = slector.indexOf(".")>-1 ? getElsClass(_obj[i],slector.split(".")[0],slector.split(".")[1]) : _obj[i].getElementsByTagName(slector);	
				for(var n=0,L=el.length;n<L;n++) {
					if(indexOF(els,el[n])==-1)
					els.push(el[n]);
				}
			}
		}
		return els;
	}
	function getElsClass(_obj,_tag,_class){
		var els = [];
		if(!_obj) return els;
		_tag = (_tag == "") ? "*" : _tag;
		var el = _obj.getElementsByTagName(_tag);
		for(var i=0,len = el.length;i<len;i++){
			if((' ' + el[i].className + ' ').indexOf(_class)>-1) {
				els.push(el[i]);
			}	
		}	
		return els;
	}
}
function getOffsetX(obj,event){
	var event = event || window.event;
	var w1 = event.offsetX;
	var w = parseInt(obj.clientWidth);
	return (w1/w);
}
function indexOF(a, c) {
	if (a.indexOf) return a.indexOf(c);
	var d = a.length;
	if (d) for (var b = 0; b < d; b++) if (a[b] === c) return b;
	return -1;
}
function timeFormat(time){
	var time = time || 0;
	var m1 = Math.floor(time/60)+"";
	if (m1.length<2){m1 = "0" + m1;}
	var m2 =  Math.floor(time - m1*60)+"";
	if (m2.length<2){m2 = "0" + m2;}
	var time = m1 + ":" + m2;
	return time;
}
function createSWF(swfUrl, domId, width, height){
	var swfDomId = domId.replace("_", "");
	var so = new SWFObject(swfUrl, swfDomId, width, height, "9.0.0", "#FFF");
		so.addParam("allowScriptAccess", "always");
		so.addParam("allowNetworking", "all");
		so.addParam("wmode", "transparent");
		so.addParam("wmode", "window");
		so.write(domId);
	return getSWF(swfDomId);
	function getSWF(asName) {
	  	if(navigator.userAgent.indexOf("MSIE") != -1) {
	  		return window[asName];
		}
	 	else{
	 		return document[asName];
		}
	}
}
</script>


</body>
</html>
